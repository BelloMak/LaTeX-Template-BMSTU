# My BMSTU LaTeX class

[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![TestVKR build shield](https://img.shields.io/badge/TestVKR-build%20227-success)](http://mt5.bmstu.ru/vkr/TestVkr.exe)

- [My BMSTU LaTeX class](#my-bmstu-latex-class)
  - [Общее описание](#общее-описание)
  - [Требования к ПО](#требования-к-по)
  - [Описание функционала Makefile](#описание-функционала-makefile)
  - [Структура репозитория](#структура-репозитория)
  - [Настройка Makefile](#настройка-makefile)


## Общее описание

Целью создания данного репозитория является желание автора упростить процесс
написания курсовых и дипломных работ с помощью LaTeX. Ввиду того, что автор
обучается в МГТУ им. Н.Э. Баумана, то за основу взят шаблон
[bmstu-latex-class](https://github.com/Orianti/bmstu-latex-class), но достаточно
сильно изменен. Документацию на определенные в классе *my-latex-class* команды 
можно найти по [ссылке](documentation/my-latex-class.pdf). Кроме того, упор 
сделан на организацию LaTeX проекта и упрощение процесса его компиляции.

В шаблоне реализовано:
- удобная сборка через makefile - сборка одной командой;
- полный и ускоренный режим сборки;
- вывод в командную строку только важных сообщений о процессе сборки.

## Требования к ПО

Для работы с классом *my-latex-class* необходимо иметь дистрибутив **MiKTeX**
или **TeXLive** с установленными пакетами, полный список которых можно найти в
[документе](documentation/my-latex-class.pdf). Также необходимо иметь
установленными следующие шрифты:
- Arial;
- Consolas;
- Times New Roman.

Рекомендуется для компиляции *pdf* файлов использовать **Makefile**.
На ОС **Linux** никаких дополнительных действий для работы с ним скорее всего не
потребуется (кроме установки дистрибутива **TeXLive** и шрифтов), на ОС
**Windows** - рекомендуется использовать эмулятор терминала **Cygwin**,
установленный согласно [инструкции](documentation/how_install_cygwin_and_LaTeX.md)
и настроенный согласно [инструкции](documentation/how_upgrade_cygwin.md) для 
улучшения опыта использования, и дистрибутив **MiKTeX**.

> При работе с файлами (например, изображениями), вставляемыми в *tex* из
> сетевого расположения, через **Cygwin** с установленным на него **TeXLive**
> часто возникает проблема с чтением этих файлов, что приводит к ошибкам
> компиляции. Для избежания подобных ситуаций рекомендуется установить
> **MiKTeX** вместо **TeXLive** и добавить в *PATH* **Cygwin** директорию 
> `some/path/MiKTeX/miktex/bin/x64/`. Подробнее об этом можно почитать
> [тут](documentation/how_install_cygwin_and_LaTeX.md).


## Описание функционала Makefile

В данном разделе представлено описание функционала директории.
Для компиляции *pdf* файлов рекомендуется использовать **Makefile**.

Чтобы выполнить команду необходимо в терминале написать `make <command>`. Полный
список поддерживаемых команд и их описание можно получить, выполнив в терминале
команду `make help` или просто `make`.

Рекомендуется придерживаться следующего алгоритма при написании документов:
- использовать команду `make fastdraft` - самый быстрый способ компиляции
  чернового варианта документа - для проверки файла на ошибки;
- использовать команду `make draft` для проверки и дебага warning-ов компиляции
  (выходы за пределы печатной области, неопределенные ссылки и т.п.);
- использовать команду `make fastbuild` - самый быстрый способ компиляции
  чернового варианта с вставленными изображениями - для получения файла при
  необходимости оценить результат вставки рисунков;
- использовать команду `make build` при необходимости получить полностью
  скомпилированный файл с водяным знаком "Черновик";
- использовать команду `make final` для компиляции финальной версии документа;
- использовать команду `make momochrome` для компиляции финальной версии
  документа c черно-белым текстом (для проверки программой TestVKR при наличии
  листингов или иного цветного текста).

Команды `make draft`, `make build`, `make momochrome` и `make final` в конце
выполнения выводят список warning-ов **LaTeX**, в то время как `make fastdraft`
и `make fastbuild` выводят только ошибки компиляции.

> Используемый для вывода предупреждений пакет может некорректно работать с
> русскими буквами, но это не сильно сказывается на понимании предупреждений.

Также в **Makefile** определены следующие команды удаления:
- `make cleantmp` - удаление всех временных файлов;
- `make clean` - удаление всех временных файлов и скомпилированных *pdf* файлов
  за исключение файла, получаемого в результате выполнения команды `make final`;
- `make cleanall` - удаление всех временных файлов и скомпилированных *pdf*
  файлов.

При использовании **Makefile** с дистрибутивом **MiKTeX** все временные файлы
компиляции помещаются в временную директорию. 

Названия выходных *pdf* файлов можно гибко регулировать в настройках
**Makefile**.


## Структура репозитория

При разработке документа рекомендуется придерживаться следующей структуры
репозитория:

```
Work_Name
├── .gitignore
├── my_latex_class
├── Makefile 
├── main.tex
├── BibDB.bib
├── soursefiles
│   ├── 000-titlepage.tex
│   ├── 001-abbreviations.tex
│   ├── 002-annotation.tex
│   ├── 010-introduction.tex
│   ├── 020-first_part.tex
│   ├── ....
├── images (if needed)
│   ├── image1.png
│   ├── ....
└── listings (if needed)
│   ├── example.py
│   └── ....
└── documentation
```

Рассмотрим каждую позицию отдельно.
- `Work_Name` - корневая директория документа;
- `my_latex_class` - директория, содержащая определение класса;
- `Makefile` - файл, вызывающий сценарии сборки;
- `main.tex` - основной файл документа, содержащий в себе подключение класса и
  всех необходимых *tex* файлов, его название может быть изменено с внесением
  соответствующих корректировок в **Makefile**;
- `BibDB.bib` - файл, содержащий библиографическую базу данных;
- `soursefiles` - директория, в которой должны располагаться *tex* файлы,
  используемые в документе, за исключением `main.tex`.
  Рекомендуется их название начинать с свободно назначаемого номера, что позволит
  проще ориентироваться в большом количестве файлов;
- `images` - директория, в которую предлагается добавлять изображения в случае
  необходимости, ее наличие не обязательно;
- `listings` - директория, в которую предлагается добавлять файлы с кодом для
  листинга, ее наличие не обязательно;
- `documentation` - директория, в которой находится документация к классу и
  инструкции по установке эмулятора терминала **Cygwin** на ОС **Windows**.

> Директории и файлы, за исключением `my_latex_class`, могут быть переименованы
> с внесением соответствующих изменений в **Makefile**, но рекомендуется
> придерживаться относительно коротких названий без указания названия работы
> (например, не создавать директорию с названием `soursefiles_research_sem_2`),
> так как в дальнейшем это затруднит перенос файлов между разными документами.


## Настройка Makefile

В [**Makefile**](Makefile) можно изменять следующие параметры, определенные в
начале файла (ниже написаны значения по умолчанию):
- TEX_SOURCE = main - имя основного *tex* файла без расширения;
- BIB_SOURCE = BibDB - имя файла библиографической базы данных *bib* без
расширения;
- FINAL_FILE_NAME = $(TEX_SOURCE) - имя выходного *pdf* файла в режиме *final*;
- MONO_FILE_NAME = $(TEX_SOURCE)_mono - имя выходного *pdf* файла в режиме
  *monochrome*;
- BUILD_FILE_NAME = build - имя выходного *pdf* файла в режиме *build*;
- FASTBUILD_FILE_NAME = fastbuild - имя выходного *pdf* файла в режиме
*fastbuild*; 
- DRAFT_FILE_NAME = draft - имя выходного *pdf* файла в режиме *draft*;
- FASTDRAFT_FILE_NAME = fastdraft - имя выходного *pdf* файла в режиме
*fastdraft*;
- AUX_DIR = tmplatex - директория для хранения временных файлов (создавать ее
не надо).

Посмотреть текущие настройки названий выходных файлов можно с помощью команды
`make help` в пункте **FILES**.